---
import LayoutNav from "../../layouts/Layout-nav.astro";
import { getCollection, getEntryBySlug } from "astro:content";

export const prerender = true;

/* 1️⃣ Rutas estáticas */
export async function getStaticPaths() {
  const portafolios = await getCollection("portafolio");

  return portafolios.map((portafolio) => ({
    params: { slug: portafolio.slug },
    props: { portafolio }, // Pass the whole object as prop to avoid fetching again
  }));
}

/* 2️⃣ Slug & Props */
const { portafolio } = Astro.props;
if (!portafolio) {
  throw new Error("Portafolio prop missing");
}

/* 3️⃣ Render */
const { Content } = await portafolio.render();

/* 4️⃣ Formato fecha */
const formatDate = (date: Date) =>
  new Intl.DateTimeFormat("es-ES", {
    day: "2-digit",
    month: "long",
    year: "numeric",
  }).format(new Date(date));
---

<LayoutNav
  title={portafolio.data.title}
  description={portafolio.data.description ||
    `Proyecto destacado: ${portafolio.data.title} realizado por Nils Pineda.`}
  image={portafolio.data.image}
>
  <article class="px-6 lg:px-40 py-20 max-w-6xl mx-auto">
    <a
      href="/portafolio"
      class="inline-flex items-center text-primary-400 hover:text-white mb-8 transition-colors"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-5 w-5 mr-2"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Volver al portafolio
    </a>

    {
      portafolio.data.image && (
        <img
          src={portafolio.data.image}
          alt={portafolio.data.title}
          class="w-full rounded-2xl mb-10 object-cover max-h-[500px]"
        />
      )
    }

    <h1 class="text-white text-4xl md:text-5xl font-bold mb-4 leading-tight">
      {portafolio.data.title}
    </h1>

    <p class="text-gray-400 text-sm mb-10 border-b border-white/10 pb-6">
      Realizado el {formatDate(portafolio.data.date)}
    </p>

    {/* ✅ CONTENIDO MARKDOWN */}
    <div class="prose prose-lg prose-invert max-w-none text-gray-300">
      <Content />
    </div>
  </article>
</LayoutNav>
